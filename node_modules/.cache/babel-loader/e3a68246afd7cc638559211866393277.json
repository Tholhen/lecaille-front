{"ast":null,"code":"var _jsxFileName = \"/Users/nicolas/Documents/Travail/Web Developper/3W Academy/Projet/site/lecaille-front/src/helpers/auth.js\";\nimport React, { useState, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { connect } from \"react-redux\";\nimport { connectUser } from \"../actions/user/userAction\";\nimport { config } from \"../config\";\nimport tokenConfig from \"../tokenConfig\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function (ChildComponent, authNeeded = false, adminNeeded = false) {\n  var _s = $RefreshSig$();\n\n  const RequireAuth = props => {\n    _s();\n\n    console.log(\"props.user = \");\n    const [redirect, setRedirect] = useState(false);\n    useEffect(() => {\n      const token = localStorage.getItem(tokenConfig.token.name);\n\n      if (!token && authNeeded) {\n        setRedirect(true);\n      } else {\n        if (!props.user.isLogged) {\n          axios.get(config.api_url + \"/user/checkToken\", {\n            headers: {\n              \"x-access-token\": token\n            }\n          }).then(response => {\n            if (response.data.status !== 200) {\n              if (authNeeded) {\n                setRedirect(true);\n              }\n            } else {\n              let user = response.data.user[0];\n\n              if (adminNeeded && user.role !== \"admin\") {\n                setRedirect(true);\n              }\n\n              props.connectUser(user);\n            }\n          });\n        }\n      }\n    }, []);\n\n    if (redirect) {\n      return /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 44,\n        columnNumber: 20\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(ChildComponent, { ...props\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 17\n    }, this);\n  };\n\n  _s(RequireAuth, \"60DZLtMy1ngv6SGw1YFAvqhU1pI=\");\n\n  const mapStateToProps = store => {\n    return {\n      user: store.user\n    };\n  };\n\n  const mapDispatchToProps = {\n    connectUser\n  };\n  return connect(mapStateToProps, mapDispatchToProps)(RequireAuth);\n}","map":{"version":3,"sources":["/Users/nicolas/Documents/Travail/Web Developper/3W Academy/Projet/site/lecaille-front/src/helpers/auth.js"],"names":["React","useState","useEffect","Redirect","axios","connect","connectUser","config","tokenConfig","ChildComponent","authNeeded","adminNeeded","RequireAuth","props","console","log","redirect","setRedirect","token","localStorage","getItem","name","user","isLogged","get","api_url","headers","then","response","data","status","role","mapStateToProps","store","mapDispatchToProps"],"mappings":";AAAA,OAAOA,KAAP,IAAeC,QAAf,EAAyBC,SAAzB,QAAyC,OAAzC;AACA,SAAQC,QAAR,QAAuB,kBAAvB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAAQC,OAAR,QAAsB,aAAtB;AACA,SAAQC,WAAR,QAA0B,4BAA1B;AAEA,SAASC,MAAT,QAAuB,WAAvB;AACA,OAAOC,WAAP,MAAwB,gBAAxB;;AAIA,eAAe,UAAUC,cAAV,EAA0BC,UAAU,GAAG,KAAvC,EAA8CC,WAAW,GAAG,KAA5D,EAAkE;AAAA;;AAC7E,QAAMC,WAAW,GAAIC,KAAD,IAAW;AAAA;;AAC3BC,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACA,UAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BhB,QAAQ,CAAC,KAAD,CAAxC;AAEAC,IAAAA,SAAS,CAAC,MAAM;AACZ,YAAMgB,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqBZ,WAAW,CAACU,KAAZ,CAAkBG,IAAvC,CAAd;;AACA,UAAG,CAACH,KAAD,IAAUR,UAAb,EAAwB;AACpBO,QAAAA,WAAW,CAAC,IAAD,CAAX;AACH,OAFD,MAEO;AACH,YAAG,CAACJ,KAAK,CAACS,IAAN,CAAWC,QAAf,EAAwB;AACpBnB,UAAAA,KAAK,CAACoB,GAAN,CAAUjB,MAAM,CAACkB,OAAP,GAAiB,kBAA3B,EAA+C;AAACC,YAAAA,OAAO,EAAE;AAAC,gCAAmBR;AAApB;AAAV,WAA/C,EACCS,IADD,CACMC,QAAQ,IAAI;AACd,gBAAGA,QAAQ,CAACC,IAAT,CAAcC,MAAd,KAAyB,GAA5B,EAAiC;AAC7B,kBAAGpB,UAAH,EAAc;AACVO,gBAAAA,WAAW,CAAC,IAAD,CAAX;AACH;AACJ,aAJD,MAIO;AACH,kBAAIK,IAAI,GAAGM,QAAQ,CAACC,IAAT,CAAcP,IAAd,CAAmB,CAAnB,CAAX;;AAEA,kBAAGX,WAAW,IAAIW,IAAI,CAACS,IAAL,KAAc,OAAhC,EAAwC;AACpCd,gBAAAA,WAAW,CAAC,IAAD,CAAX;AACH;;AAEDJ,cAAAA,KAAK,CAACP,WAAN,CAAkBgB,IAAlB;AACH;AACJ,WAfD;AAgBH;AACJ;AACJ,KAxBQ,EAwBN,EAxBM,CAAT;;AA0BA,QAAGN,QAAH,EAAY;AACR,0BAAO,QAAC,QAAD;AAAU,QAAA,EAAE,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,cAAP;AACH;;AAED,wBAAQ,QAAC,cAAD,OAAoBH;AAApB;AAAA;AAAA;AAAA;AAAA,YAAR;AACH,GAnCD;;AAD6E,KACvED,WADuE;;AAuC7E,QAAMoB,eAAe,GAAIC,KAAD,IAAW;AAC/B,WAAO;AACHX,MAAAA,IAAI,EAAEW,KAAK,CAACX;AADT,KAAP;AAGH,GAJD;;AAMA,QAAMY,kBAAkB,GAAG;AACvB5B,IAAAA;AADuB,GAA3B;AAIA,SAAOD,OAAO,CAAC2B,eAAD,EAAiBE,kBAAjB,CAAP,CAA4CtB,WAA5C,CAAP;AACH","sourcesContent":["import React, {useState, useEffect} from \"react\";\nimport {Redirect} from \"react-router-dom\"\nimport axios from \"axios\";\nimport {connect} from \"react-redux\"\nimport {connectUser} from \"../actions/user/userAction\"\n\nimport { config } from \"../config\";\nimport tokenConfig from \"../tokenConfig\";\n\n\n\nexport default function (ChildComponent, authNeeded = false, adminNeeded = false){\n    const RequireAuth = (props) => {\n        console.log(\"props.user = \")\n        const [redirect, setRedirect] = useState(false)\n\n        useEffect(() => {\n            const token = localStorage.getItem(tokenConfig.token.name)\n            if(!token && authNeeded){\n                setRedirect(true)\n            } else {\n                if(!props.user.isLogged){\n                    axios.get(config.api_url + \"/user/checkToken\", {headers: {\"x-access-token\" : token}})\n                    .then(response => {\n                        if(response.data.status !== 200) {\n                            if(authNeeded){\n                                setRedirect(true)\n                            }\n                        } else {\n                            let user = response.data.user[0]\n    \n                            if(adminNeeded && user.role !== \"admin\"){\n                                setRedirect(true)\n                            }\n                            \n                            props.connectUser(user)\n                        }\n                    })\n                }\n            }\n        }, [])\n\n        if(redirect){\n            return <Redirect to=\"/\" />\n        }\n\n        return (<ChildComponent {...props} />)\n    }\n\n\n    const mapStateToProps = (store) => {\n        return {\n            user: store.user\n        }\n    }\n\n    const mapDispatchToProps = {\n        connectUser\n    }\n\n    return connect(mapStateToProps,mapDispatchToProps)(RequireAuth)\n}\n\n"]},"metadata":{},"sourceType":"module"}