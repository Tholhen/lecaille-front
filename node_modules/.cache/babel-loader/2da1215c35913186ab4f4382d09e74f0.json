{"ast":null,"code":"import _objectSpread from\"/Users/nicolas/Documents/Travail/Web Developper/3W Academy/Projet/site/lecaille-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/nicolas/Documents/Travail/Web Developper/3W Academy/Projet/site/lecaille-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/nicolas/Documents/Travail/Web Developper/3W Academy/Projet/site/lecaille-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{config}from\"../../config/config\";//Imports des composants de l'UI externes\nimport Header from\"../headers/header\";import HeaderPages from\"../headers/headerPages\";import Footer from\"../footer\";import AdminMenu from\"../../components/adminMenu\";import{getDailyStand,getDailyStandDetails,saveDailyStand,saveDailyStandDetail,saveDailyStandDetailPict,deleteDailyStand,updateDailyStand,deleteDailyStandDetail,clearDailyStandDetails}from\"../../api/dailyStand\";//Imports des composants de la librairie MaterialUI\nimport{Button}from'@material-ui/core';import TextField from'@material-ui/core/TextField';import FormControl from'@material-ui/core/FormControl';import{makeStyles}from\"@material-ui/styles\";import DeleteIcon from'@material-ui/icons/Delete';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AdminDailyStand=function AdminDailyStand(props){var headerTitle=\"Administration\";var headerBreadcrumbs=[{value:\"Accueil\",link:\"/\"},{value:\"Administration\",link:\"/admin\"},{value:\"Etal\",link:null}];var _useState=useState({id:\"\",description:\"\",creation_timestamp:\"\"}),_useState2=_slicedToArray(_useState,2),dailyStand=_useState2[0],setDailyStand=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),dailyStandItemsToAdd=_useState4[0],setDailyStandItemsToAdd=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),errorForm=_useState6[0],setErrorForm=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),dailyStandItemsDisplayed=_useState8[0],setDailyStandItemsDisplayed=_useState8[1];//Définition des styles MaterialUI\nvar useStyles=makeStyles(function(theme){return{margin:{margin:theme.spacing(1)},dailyStandDescription:{width:\"90%\",margin:theme.spacing(1)}};});var classes=useStyles();//Au chargement de la page\nuseEffect(function(){refreshDatas();},[]);var refreshDatas=function refreshDatas(){getDailyStand().then(function(dailyStandDB){if(dailyStandDB){setDailyStand(dailyStandDB);}getDailyStandDetails().then(function(dailyStandItemsDB){setDailyStandItemsDisplayed(dailyStandItemsDB);});});};//Fonction de suppression d'un élément de l'étal du jour\nvar deleteDailyStandItem=function deleteDailyStandItem(id){deleteDailyStandDetail(id);var newArray=dailyStandItemsDisplayed.filter(function(item){return item.id!==id;});setDailyStandItemsDisplayed(newArray);};//Ajout des champs permettant de compléter l'étal du jour\nvar addElement=function addElement(){setDailyStandItemsToAdd(function(dailyStandItemsToAdd){return[].concat(_toConsumableArray(dailyStandItemsToAdd),[{pict_url:\"\",description:\"\",filePreview:\"\",selectedFile:\"\"}]);});};//Initialisation d'un nouveau étal\nvar newDailyStand=function newDailyStand(){deleteDailyStand();clearDailyStandDetails();setDailyStand({id:\"\",description:\"\",creation_timestamp:\"\"});setDailyStandItemsDisplayed([]);setDailyStandItemsToAdd([]);};//Fonction d'enregistrement de l'étal\nvar handleSave=function handleSave(){//Vérification des données avant enregistrement\nvar conformFiles=false;for(var i=0;i<dailyStandItemsToAdd.length;i++){if(dailyStandItemsToAdd[i].selectedFile){conformFiles=true;}}if(!conformFiles&&!dailyStand.description&&dailyStandItemsDisplayed.length===0){setErrorForm(true);}else{setErrorForm(false);var dailyStandDatas={description:dailyStand.description};if(dailyStand.id===\"\"){saveDailyStand(dailyStandDatas).then(function(responseDailyStand){setDailyStand(_objectSpread(_objectSpread({},dailyStand),{},{\"id\":responseDailyStand.data.result.insertId}));if(conformFiles){var _loop=function _loop(_i){if(dailyStandItemsToAdd[_i].selectedFile){saveDailyStandDetailPict(dailyStandItemsToAdd[_i].selectedFile).then(function(responseDailyStandDetailPict){var dailyStandDetailDatas={description:dailyStandItemsToAdd[_i].description,pict_url:responseDailyStandDetailPict.data.url||\"\",id_daily_stand:responseDailyStand.data.result.insertId};saveDailyStandDetail(dailyStandDetailDatas).then(function(response){setDailyStandItemsToAdd([]);refreshDatas();});});}};for(var _i=0;_i<dailyStandItemsToAdd.length;_i++){_loop(_i);}}});}else{updateDailyStand(dailyStandDatas).then(function(response){var _loop2=function _loop2(_i2){if(dailyStandItemsToAdd[_i2].selectedFile){saveDailyStandDetailPict(dailyStandItemsToAdd[_i2].selectedFile).then(function(responseDailyStandDetailPict){var dailyStandDetailDatas={description:dailyStandItemsToAdd[_i2].description,pict_url:responseDailyStandDetailPict.data.url||\"\",id_daily_stand:dailyStand.id};saveDailyStandDetail(dailyStandDetailDatas).then(function(response){setDailyStandItemsToAdd([]);refreshDatas();});});}};for(var _i2=0;_i2<dailyStandItemsToAdd.length;_i2++){_loop2(_i2);}});}}};var changeFile=function changeFile(file,index){var tempArray=_toConsumableArray(dailyStandItemsToAdd);tempArray[index].filePreview=URL.createObjectURL(file);tempArray[index].selectedFile=file;setDailyStandItemsToAdd(tempArray);};return/*#__PURE__*/_jsxs(\"section\",{className:\"root\",children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(HeaderPages,{headerTitle:headerTitle,headerBreadcrumbs:headerBreadcrumbs}),/*#__PURE__*/_jsxs(\"section\",{className:\"admin-container\",children:[/*#__PURE__*/_jsx(AdminMenu,{}),/*#__PURE__*/_jsxs(\"section\",{className:\"admin-content\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Gestion de l'\\xE9tal du jour\"}),/*#__PURE__*/_jsxs(\"section\",{className:\"admin-dailystand-header\",children:[/*#__PURE__*/_jsxs(\"section\",{className:\"admin-dailystand-interractions\",children:[errorForm&&/*#__PURE__*/_jsx(\"p\",{children:\"Veuillez saisir une description de l'\\xE9tal et/ou au moins une image d'illustration\"}),dailyStand.id!==\"\"&&/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"primary\",onClick:function onClick(e){newDailyStand();},className:classes.margin,children:\"Nouvel Etal\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"primary\",onClick:function onClick(e){addElement();},className:classes.margin,children:\"Ajouter un \\xE9l\\xE9ment\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:function onClick(e){return handleSave();},className:classes.margin,children:\"Enregistrer\"})]}),/*#__PURE__*/_jsx(FormControl,{className:classes.dailyStandDescription,children:/*#__PURE__*/_jsx(TextField,{label:\"Description de l'\\xE9tal\",multiline:true,rows:8,variant:\"filled\",onChange:function onChange(e){setDailyStand(_objectSpread(_objectSpread({},dailyStand),{},{\"description\":e.target.value}));},value:dailyStand.description})})]}),/*#__PURE__*/_jsxs(\"section\",{className:\"admin-dailystand-content\",children:[dailyStandItemsToAdd.length>0&&/*#__PURE__*/_jsx(\"section\",{className:\"admin-dailystand-toadd\",children:dailyStandItemsToAdd.map(function(dailyStandItemToAdd,index){return/*#__PURE__*/_jsxs(\"article\",{children:[/*#__PURE__*/_jsxs(\"section\",{children:[/*#__PURE__*/_jsxs(FormControl,{children:[/*#__PURE__*/_jsx(\"input\",{accept:\"images/*\",style:{display:'none'},id:\"file-select\"+index,type:\"file\",onChange:function onChange(e){changeFile(e.target.files[0],index);}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"file-select\"+index,children:/*#__PURE__*/_jsx(Button,{color:\"primary\",component:\"span\",children:\"Ajouter une photo\"})})]}),dailyStandItemToAdd.selectedFile&&/*#__PURE__*/_jsxs(\"section\",{className:\"admin-dailystand-filepreview\",children:[/*#__PURE__*/_jsx(\"p\",{children:dailyStandItemToAdd.selectedFile.name}),/*#__PURE__*/_jsx(\"img\",{src:dailyStandItemToAdd.filePreview,alt:\"Prévisualistation du fichier\"+dailyStandItemToAdd.selectedFile.name})]})]}),/*#__PURE__*/_jsxs(\"section\",{children:[/*#__PURE__*/_jsx(FormControl,{className:classes.dailyStandDescription,children:/*#__PURE__*/_jsx(TextField,{label:\"Description\",variant:\"filled\",onChange:function onChange(e){dailyStandItemToAdd.description=e.target.value;}})}),/*#__PURE__*/_jsx(\"p\",{children:dailyStandItemToAdd.description})]})]},index);})}),/*#__PURE__*/_jsx(\"section\",{className:\"admin-dailystand-items\",children:dailyStandItemsDisplayed&&dailyStandItemsDisplayed.map(function(dailyStandItem){return/*#__PURE__*/_jsxs(\"article\",{children:[/*#__PURE__*/_jsx(\"section\",{children:/*#__PURE__*/_jsx(\"img\",{src:config.dailystand_detail_pict_url+dailyStandItem.pict_url,alt:\"illustration\"+dailyStandItem.id})}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Description : \",/*#__PURE__*/_jsx(\"em\",{children:dailyStandItem.description})]}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(){deleteDailyStandItem(dailyStandItem.id);},children:/*#__PURE__*/_jsx(DeleteIcon,{})})]},dailyStandItem.id);})})]})]})]}),/*#__PURE__*/_jsx(Footer,{})]});};export default AdminDailyStand;","map":{"version":3,"sources":["/Users/nicolas/Documents/Travail/Web Developper/3W Academy/Projet/site/lecaille-front/src/containers/admin/adminDailyStand.js"],"names":["React","useState","useEffect","config","Header","HeaderPages","Footer","AdminMenu","getDailyStand","getDailyStandDetails","saveDailyStand","saveDailyStandDetail","saveDailyStandDetailPict","deleteDailyStand","updateDailyStand","deleteDailyStandDetail","clearDailyStandDetails","Button","TextField","FormControl","makeStyles","DeleteIcon","AdminDailyStand","props","headerTitle","headerBreadcrumbs","value","link","id","description","creation_timestamp","dailyStand","setDailyStand","dailyStandItemsToAdd","setDailyStandItemsToAdd","errorForm","setErrorForm","dailyStandItemsDisplayed","setDailyStandItemsDisplayed","useStyles","theme","margin","spacing","dailyStandDescription","width","classes","refreshDatas","then","dailyStandDB","dailyStandItemsDB","deleteDailyStandItem","newArray","filter","item","addElement","pict_url","filePreview","selectedFile","newDailyStand","handleSave","conformFiles","i","length","dailyStandDatas","responseDailyStand","data","result","insertId","responseDailyStandDetailPict","dailyStandDetailDatas","url","id_daily_stand","response","changeFile","file","index","tempArray","URL","createObjectURL","e","target","map","dailyStandItemToAdd","display","files","name","dailyStandItem","dailystand_detail_pict_url"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from \"react\";\nimport {config} from \"../../config/config\"\n\n//Imports des composants de l'UI externes\nimport Header from \"../headers/header\"\nimport HeaderPages from \"../headers/headerPages\"\nimport Footer from \"../footer\"\nimport AdminMenu from \"../../components/adminMenu\"\n\nimport {getDailyStand, getDailyStandDetails, saveDailyStand, saveDailyStandDetail, saveDailyStandDetailPict, deleteDailyStand, updateDailyStand, deleteDailyStandDetail, clearDailyStandDetails} from \"../../api/dailyStand\"\n\n//Imports des composants de la librairie MaterialUI\nimport { Button } from '@material-ui/core';\nimport TextField from '@material-ui/core/TextField';\nimport FormControl from '@material-ui/core/FormControl';\nimport { makeStyles } from \"@material-ui/styles\";\nimport DeleteIcon from '@material-ui/icons/Delete'\n\nconst AdminDailyStand = (props) => {\n\n    const headerTitle = \"Administration\"\n    const headerBreadcrumbs = [{value: \"Accueil\", link:\"/\"},{value: \"Administration\", link:\"/admin\"}, {value: \"Etal\", link:null}]\n\n    const [dailyStand, setDailyStand] = useState({id:\"\", description:\"\", creation_timestamp:\"\"})\n    const [dailyStandItemsToAdd, setDailyStandItemsToAdd] = useState([])\n    const [errorForm, setErrorForm] = useState(false)\n    const [dailyStandItemsDisplayed, setDailyStandItemsDisplayed] = useState([])\n\n\n    //Définition des styles MaterialUI\n    const useStyles = makeStyles((theme) => ({\n        margin:{\n            margin: theme.spacing(1),\n        },\n        dailyStandDescription:{\n            width:\"90%\",\n            margin: theme.spacing(1)\n        }\n        }));\n        \n    const classes = useStyles();\n\n    \n\n    //Au chargement de la page\n    useEffect(() => {\n        refreshDatas()\n    }, [])\n\n    const refreshDatas = () => {\n        getDailyStand()\n        .then(dailyStandDB => {\n            if(dailyStandDB){\n                setDailyStand(dailyStandDB)\n                \n            }\n            getDailyStandDetails()\n                .then(dailyStandItemsDB => {\n                    setDailyStandItemsDisplayed(dailyStandItemsDB)\n                })\n        })\n    }\n\n    //Fonction de suppression d'un élément de l'étal du jour\n    const deleteDailyStandItem = (id) => {\n        deleteDailyStandDetail(id)\n        let newArray = dailyStandItemsDisplayed.filter(item => item.id !== id)\n        setDailyStandItemsDisplayed(newArray)\n    }\n\n    //Ajout des champs permettant de compléter l'étal du jour\n    const addElement = () => {\n        setDailyStandItemsToAdd(dailyStandItemsToAdd => [...dailyStandItemsToAdd,\n            {pict_url:\"\",\n            description: \"\",\n            filePreview: \"\",\n            selectedFile: \"\"}])\n    }    \n\n    //Initialisation d'un nouveau étal\n    const newDailyStand = () => {\n        deleteDailyStand()\n        clearDailyStandDetails()\n        setDailyStand({id:\"\", description:\"\", creation_timestamp:\"\"})\n        setDailyStandItemsDisplayed([])\n        setDailyStandItemsToAdd([])\n    }\n\n    //Fonction d'enregistrement de l'étal\n    const handleSave = () => {\n\n        //Vérification des données avant enregistrement\n        let conformFiles = false\n        for(let i = 0; i < dailyStandItemsToAdd.length; i++){\n            if(dailyStandItemsToAdd[i].selectedFile){\n                conformFiles = true\n            }\n        }\n\n        if(!conformFiles && !dailyStand.description && dailyStandItemsDisplayed.length === 0){\n            setErrorForm(true)\n        } else {\n            setErrorForm(false)\n            let dailyStandDatas = {description: dailyStand.description}\n            if(dailyStand.id === \"\"){\n                saveDailyStand(dailyStandDatas)\n                .then(responseDailyStand => {\n                    setDailyStand({...dailyStand, \"id\": responseDailyStand.data.result.insertId})\n                    if(conformFiles){\n                        for(let i = 0; i < dailyStandItemsToAdd.length; i++){\n                            if(dailyStandItemsToAdd[i].selectedFile){\n                                saveDailyStandDetailPict(dailyStandItemsToAdd[i].selectedFile)\n                                .then(responseDailyStandDetailPict => {\n                                    let dailyStandDetailDatas = {\n                                        description: dailyStandItemsToAdd[i].description,\n                                        pict_url: responseDailyStandDetailPict.data.url || \"\",\n                                        id_daily_stand: responseDailyStand.data.result.insertId\n                                    }   \n                                    saveDailyStandDetail(dailyStandDetailDatas)\n                                    .then(response => {\n                                        setDailyStandItemsToAdd([])\n                                        refreshDatas()\n                                    })\n                                })\n                            }\n                        }\n                    }\n                    \n                })\n            }\n            else {\n                updateDailyStand(dailyStandDatas)\n                .then(response => {\n                    for(let i = 0; i < dailyStandItemsToAdd.length; i++){\n                        if(dailyStandItemsToAdd[i].selectedFile){\n                            saveDailyStandDetailPict(dailyStandItemsToAdd[i].selectedFile)\n                            .then(responseDailyStandDetailPict => {\n                                let dailyStandDetailDatas = {\n                                    description: dailyStandItemsToAdd[i].description,\n                                    pict_url: responseDailyStandDetailPict.data.url  || \"\",\n                                    id_daily_stand: dailyStand.id\n                                }\n                                saveDailyStandDetail(dailyStandDetailDatas)\n                                .then(response => {\n                                    setDailyStandItemsToAdd([])\n                                    refreshDatas()\n                                })\n                            })\n                        }\n                    }\n                })\n            }\n        }\n        \n    }\n\n    const changeFile = (file, index) => {\n        let tempArray = [...dailyStandItemsToAdd]\n        tempArray[index].filePreview = URL.createObjectURL(file)\n        tempArray[index].selectedFile = file\n        setDailyStandItemsToAdd(tempArray)\n    }\n\n    return(\n        <section className=\"root\">\n                <Header />\n                <HeaderPages headerTitle={headerTitle} headerBreadcrumbs={headerBreadcrumbs}/>\n                <section className=\"admin-container\">\n                    <AdminMenu />\n \n                    <section className=\"admin-content\">\n                        <h4>Gestion de l'étal du jour</h4>\n\n                        <section className=\"admin-dailystand-header\">\n                            <section className=\"admin-dailystand-interractions\">\n                                {errorForm && <p>Veuillez saisir une description de l'étal et/ou au moins une image d'illustration</p>}\n                                {dailyStand.id !== \"\" && <Button variant=\"outlined\" color=\"primary\" onClick={(e) => {newDailyStand()}} className={classes.margin}>Nouvel Etal</Button>}\n                                <Button variant=\"outlined\" color=\"primary\" onClick={(e) => {addElement()}} className={classes.margin}>Ajouter un élément</Button>\n                                <Button variant=\"contained\" color=\"primary\" onClick={(e) => handleSave()} className={classes.margin}>Enregistrer</Button>\n                            </section>\n                            <FormControl className={classes.dailyStandDescription}>\n                                <TextField label=\"Description de l'étal\" multiline rows={8} variant=\"filled\" \n                                onChange={(e) => {setDailyStand({...dailyStand, \"description\": e.target.value})}}\n                                value={dailyStand.description} />\n                            </FormControl>\n                        </section>\n\n                        \n\n                        <section className=\"admin-dailystand-content\">\n                            \n                            {dailyStandItemsToAdd.length > 0 && <section className=\"admin-dailystand-toadd\">\n                                {dailyStandItemsToAdd.map((dailyStandItemToAdd, index) => {\n                                    return(<article key={index}>\n                                        <section>\n                                            <FormControl>\n                                                <input \n                                                accept=\"images/*\"\n                                                style={{display: 'none'}}\n                                                id={\"file-select\"+index}\n                                                type=\"file\"\n                                                onChange={(e) => {changeFile(e.target.files[0], index)}}\n                                                />\n                                                <label htmlFor={\"file-select\"+index}>\n                                                    <Button color=\"primary\" component=\"span\">Ajouter une photo</Button>\n                                                </label>\n                                            </FormControl>\n                                            {dailyStandItemToAdd.selectedFile && \n                                                <section className=\"admin-dailystand-filepreview\">\n                                                    <p>{dailyStandItemToAdd.selectedFile.name}</p>\n                                                    <img src={dailyStandItemToAdd.filePreview} alt={\"Prévisualistation du fichier\" + dailyStandItemToAdd.selectedFile.name} />\n                                                </section>}\n                                            \n                                        </section>\n                                        <section>\n                                            <FormControl className={classes.dailyStandDescription}>\n                                                <TextField label=\"Description\" variant=\"filled\" onChange={(e) => {dailyStandItemToAdd.description = e.target.value}} />\n                                            </FormControl>\n                                            <p>{dailyStandItemToAdd.description}</p>\n                                        </section>\n\n                                    </article> ) \n                                })\n                                }\n                            </section>}\n                            \n                            <section className=\"admin-dailystand-items\">\n                                {dailyStandItemsDisplayed && dailyStandItemsDisplayed.map((dailyStandItem) => {\n                                    return (<article key={dailyStandItem.id}>\n                                    <section>\n                                        <img src={config.dailystand_detail_pict_url + dailyStandItem.pict_url} alt={\"illustration\"+dailyStandItem.id}></img>\n                                    </section>\n                                    \n                                    <p>Description : <em>{dailyStandItem.description}</em></p>\n                                    \n                                    <Button onClick={() => {deleteDailyStandItem(dailyStandItem.id)}}><DeleteIcon /></Button>\n                                </article>)\n                                })}\n                            </section>\n                        </section>\n                    </section>\n                </section>\n                <Footer />\n        </section>\n    )\n\n}\n\nexport default AdminDailyStand"]},"metadata":{},"sourceType":"module"}