{"ast":null,"code":"import _objectSpread from\"/Users/nicolas/Documents/Travail/Web Developper/3W Academy/Projet/site/lecaille-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/nicolas/Documents/Travail/Web Developper/3W Academy/Projet/site/lecaille-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Redirect}from\"react-router-dom\";import axios from\"axios\";import{connect}from\"react-redux\";import{connectUser}from\"../actions/user/userAction\";import{config}from\"../config/config\";import tokenConfig from\"../config/tokenConfig\";import{jsx as _jsx}from\"react/jsx-runtime\";export default function auth(ChildComponent){var authNeeded=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var adminNeeded=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var RequireAuth=function RequireAuth(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),redirect=_useState2[0],setRedirect=_useState2[1];useEffect(function(){var token=localStorage.getItem(tokenConfig.token.name);if(!token&&authNeeded){setRedirect(true);}else{if(!props.user.isLogged){axios.get(config.api_url+\"/user/checkToken\",{headers:{\"x-access-token\":token}}).then(function(response){if(response.data.status!==200){if(authNeeded){setRedirect(true);}}else{var user=response.data.user[0];if(adminNeeded&&user.role!==\"Admin\"){setRedirect(true);}props.connectUser(user);}});}}},[props]);if(redirect){return/*#__PURE__*/_jsx(Redirect,{to:\"/\"});}return/*#__PURE__*/_jsx(ChildComponent,_objectSpread({},props));};var mapStateToProps=function mapStateToProps(store){return{user:store.user};};var mapDispatchToProps={connectUser:connectUser};return connect(mapStateToProps,mapDispatchToProps)(RequireAuth);}","map":{"version":3,"sources":["/Users/nicolas/Documents/Travail/Web Developper/3W Academy/Projet/site/lecaille-front/src/helpers/auth.js"],"names":["React","useState","useEffect","Redirect","axios","connect","connectUser","config","tokenConfig","auth","ChildComponent","authNeeded","adminNeeded","RequireAuth","props","redirect","setRedirect","token","localStorage","getItem","name","user","isLogged","get","api_url","headers","then","response","data","status","role","mapStateToProps","store","mapDispatchToProps"],"mappings":"uZAAA,MAAOA,CAAAA,KAAP,EAAeC,QAAf,CAAyBC,SAAzB,KAAyC,OAAzC,CACA,OAAQC,QAAR,KAAuB,kBAAvB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAAQC,OAAR,KAAsB,aAAtB,CACA,OAAQC,WAAR,KAA0B,4BAA1B,CAEA,OAASC,MAAT,KAAuB,kBAAvB,CACA,MAAOC,CAAAA,WAAP,KAAwB,uBAAxB,C,2CAIA,cAAe,SAASC,CAAAA,IAAT,CAAcC,cAAd,CAAsE,IAAxCC,CAAAA,UAAwC,2DAA3B,KAA2B,IAApBC,CAAAA,WAAoB,2DAAN,KAAM,CACjF,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,KAAD,CAAW,CAC3B,cAAgCb,QAAQ,CAAC,KAAD,CAAxC,wCAAOc,QAAP,eAAiBC,WAAjB,eAEAd,SAAS,CAAC,UAAM,CACZ,GAAMe,CAAAA,KAAK,CAAGC,YAAY,CAACC,OAAb,CAAqBX,WAAW,CAACS,KAAZ,CAAkBG,IAAvC,CAAd,CAEA,GAAG,CAACH,KAAD,EAAUN,UAAb,CAAwB,CACpBK,WAAW,CAAC,IAAD,CAAX,CACH,CAFD,IAEO,CACH,GAAG,CAACF,KAAK,CAACO,IAAN,CAAWC,QAAf,CAAwB,CACpBlB,KAAK,CAACmB,GAAN,CAAUhB,MAAM,CAACiB,OAAP,CAAiB,kBAA3B,CAA+C,CAACC,OAAO,CAAE,CAAC,iBAAmBR,KAApB,CAAV,CAA/C,EACCS,IADD,CACM,SAAAC,QAAQ,CAAI,CACd,GAAGA,QAAQ,CAACC,IAAT,CAAcC,MAAd,GAAyB,GAA5B,CAAiC,CAC7B,GAAGlB,UAAH,CAAc,CACVK,WAAW,CAAC,IAAD,CAAX,CACH,CACJ,CAJD,IAIO,CACH,GAAIK,CAAAA,IAAI,CAAGM,QAAQ,CAACC,IAAT,CAAcP,IAAd,CAAmB,CAAnB,CAAX,CACA,GAAGT,WAAW,EAAIS,IAAI,CAACS,IAAL,GAAc,OAAhC,CAAwC,CACpCd,WAAW,CAAC,IAAD,CAAX,CACH,CACDF,KAAK,CAACR,WAAN,CAAkBe,IAAlB,EACH,CACJ,CAbD,EAcH,CACJ,CACJ,CAvBQ,CAuBN,CAACP,KAAD,CAvBM,CAAT,CAyBA,GAAGC,QAAH,CAAY,CACR,mBAAO,KAAC,QAAD,EAAU,EAAE,CAAC,GAAb,EAAP,CACH,CAED,mBAAQ,KAAC,cAAD,kBAAoBD,KAApB,EAAR,CACH,CAjCD,CAoCA,GAAMiB,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACC,KAAD,CAAW,CAC/B,MAAO,CACHX,IAAI,CAAEW,KAAK,CAACX,IADT,CAAP,CAGH,CAJD,CAMA,GAAMY,CAAAA,kBAAkB,CAAG,CACvB3B,WAAW,CAAXA,WADuB,CAA3B,CAIA,MAAOD,CAAAA,OAAO,CAAC0B,eAAD,CAAiBE,kBAAjB,CAAP,CAA4CpB,WAA5C,CAAP,CACH","sourcesContent":["import React, {useState, useEffect} from \"react\";\nimport {Redirect} from \"react-router-dom\"\nimport axios from \"axios\";\nimport {connect} from \"react-redux\"\nimport {connectUser} from \"../actions/user/userAction\"\n\nimport { config } from \"../config/config\";\nimport tokenConfig from \"../config/tokenConfig\";\n\n\n\nexport default function auth(ChildComponent, authNeeded = false, adminNeeded = false){\n    const RequireAuth = (props) => {\n        const [redirect, setRedirect] = useState(false)\n\n        useEffect(() => {\n            const token = localStorage.getItem(tokenConfig.token.name)\n            \n            if(!token && authNeeded){\n                setRedirect(true)\n            } else {\n                if(!props.user.isLogged){\n                    axios.get(config.api_url + \"/user/checkToken\", {headers: {\"x-access-token\" : token}})\n                    .then(response => {\n                        if(response.data.status !== 200) {\n                            if(authNeeded){\n                                setRedirect(true)\n                            }\n                        } else {\n                            let user = response.data.user[0]\n                            if(adminNeeded && user.role !== \"Admin\"){\n                                setRedirect(true)\n                            }\n                            props.connectUser(user)\n                        }\n                    })\n                }\n            }\n        }, [props])\n\n        if(redirect){\n            return <Redirect to=\"/\" />\n        }\n\n        return (<ChildComponent {...props} />)\n    }\n\n\n    const mapStateToProps = (store) => {\n        return {\n            user: store.user\n        }\n    }\n\n    const mapDispatchToProps = {\n        connectUser\n    }\n\n    return connect(mapStateToProps,mapDispatchToProps)(RequireAuth)\n}\n\n"]},"metadata":{},"sourceType":"module"}